<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Form Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form { max-width: 500px; margin: 0 auto; }
        .form-input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; }
        .form-btn { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .form-btn:disabled { background: #ccc; cursor: not-allowed; }
        .status { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>Contact Form Test</h1>
    
    <div class="form">
        <form id="test-form">
            <input type="text" name="user_name" class="form-input" placeholder="Full name" required>
            <input type="email" name="user_email" class="form-input" placeholder="Email address" required>
            <textarea name="message" class="form-input" placeholder="Your Message" required rows="5"></textarea>
            <button class="form-btn" type="submit" disabled id="submit-btn">Send Test Message</button>
        </form>
        
        <div id="status"></div>
        
        <h3>Debug Information</h3>
        <div id="debug-info">
            <p><strong>EmailJS Status:</strong> <span id="emailjs-status">Checking...</span></p>
            <p><strong>Environment:</strong> <span id="environment"></span></p>
            <p><strong>Current URL:</strong> <span id="current-url"></span></p>
        </div>
    </div>

    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <script>
        // Debug information
        document.getElementById('current-url').textContent = window.location.href;
        
        const isLocal = window.location.protocol === 'file:' || 
                       window.location.hostname === 'localhost' || 
                       window.location.hostname === '127.0.0.1';
        
        document.getElementById('environment').textContent = isLocal ? 'Local' : 'Server';
        
        // Check EmailJS availability
        if (typeof emailjs !== 'undefined') {
            document.getElementById('emailjs-status').textContent = 'Available';
            document.getElementById('emailjs-status').style.color = 'green';
        } else {
            document.getElementById('emailjs-status').textContent = 'Not Available';
            document.getElementById('emailjs-status').style.color = 'red';
        }
        
        // Form validation
        const form = document.getElementById('test-form');
        const inputs = form.querySelectorAll('input, textarea');
        const submitBtn = document.getElementById('submit-btn');
        const statusDiv = document.getElementById('status');
        
        function checkFormValidity() {
            if (form.checkValidity()) {
                submitBtn.removeAttribute('disabled');
            } else {
                submitBtn.setAttribute('disabled', '');
            }
        }
        
        inputs.forEach(input => {
            input.addEventListener('input', checkFormValidity);
        });
        
        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Sending...';
            submitBtn.setAttribute('disabled', '');
            
            statusDiv.innerHTML = '<div class="info">Attempting to send message...</div>';
            
            if (isLocal) {
                statusDiv.innerHTML = '<div class="info">Local environment detected. Opening email client...</div>';
                
                const name = document.querySelector('input[name="user_name"]').value;
                const email = document.querySelector('input[name="user_email"]').value;
                const message = document.querySelector('textarea[name="message"]').value;
                
                const subject = encodeURIComponent(`Portfolio Contact Test: Message from ${name}`);
                const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\n\nMessage:\n${message}`);
                
                setTimeout(() => {
                    window.location.href = `mailto:h3nryhu@gmail.com?subject=${subject}&body=${body}`;
                    statusDiv.innerHTML = '<div class="success">Email client opened successfully!</div>';
                    submitBtn.textContent = originalText;
                    form.reset();
                    checkFormValidity();
                }, 1000);
                
            } else if (typeof emailjs !== 'undefined') {
                // Initialize EmailJS
                emailjs.init("0bFk33zdsm-Iyw5xr");
                
                // Send email
                emailjs.sendForm('Message_Gmail', 'template_ja228jq', form)
                    .then(function(response) {
                        console.log('SUCCESS!', response.status, response.text);
                        statusDiv.innerHTML = '<div class="success">Message sent successfully via EmailJS!</div>';
                        form.reset();
                        checkFormValidity();
                    }, function(error) {
                        console.log('FAILED...', error);
                        statusDiv.innerHTML = `<div class="error">EmailJS failed: ${error.text || error.message || 'Unknown error'}. <a href="#" onclick="tryMailto()">Try mailto instead</a></div>`;
                    })
                    .finally(() => {
                        submitBtn.textContent = originalText;
                        checkFormValidity();
                    });
            } else {
                statusDiv.innerHTML = '<div class="error">EmailJS not available. <a href="#" onclick="tryMailto()">Try mailto instead</a></div>';
                submitBtn.textContent = originalText;
                checkFormValidity();
            }
        });
        
        function tryMailto() {
            const name = document.querySelector('input[name="user_name"]').value;
            const email = document.querySelector('input[name="user_email"]').value;
            const message = document.querySelector('textarea[name="message"]').value;
            
            const subject = encodeURIComponent(`Portfolio Contact: Message from ${name}`);
            const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\n\nMessage:\n${message}`);
            
            window.location.href = `mailto:h3nryhu@gmail.com?subject=${subject}&body=${body}`;
        }
    </script>
</body>
</html>